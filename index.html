<html>
  <head>
    <meta charset = 'UTF-8'>
    <title>云邮，随时随地</title>
    <link rel="icon" href="favicon.ico">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests;">
    <script>
    var nowname = null;
    function apt(tin,wm){
	    return '&' + tin + '=' + wm;
    }
    function apd(act){
		var yon = 'https://tinywebdb.appinventor.space/api?user=mail317&secret=bb6dc299&action=' + act;
		return yon;
    }
    function pt(o,...args){
		var xhr = new XMLHttpRequest();
        var url = '';
		if (o === 'count'){
			url = apd(o);
		}
		else if (o === 'get'){
			url = apd(o) + apt('tag',args[0]);
		}
		else if (o === 'delete'){
			url = apd(o) + apt('tag',args[0]);
		}
		else if (o === 'update'){
			url = apd(o) + apt('tag',args[0]) + apt('value',args[1]);
		}
		else if (o === 'search'){
			url = apd(o) + apt('no',args[0]) + apt('count',args[1]) + apt('tag',args[2]) + apt('type',args[3]);
		}
		xhr.open("GET", url, false); 
		xhr.send();
		if (xhr.status === 200) {
		    return(xhr.responseText);
		} else {
		    return(xhr.statusText);
		}
   	};
	function login(){
		var d1 = document.getElementById('naee').value;
		var d2 = document.getElementById('phin').value;
		var d3 = JSON.parse(pt('get',d1 + '_password'));
		if (d3[d1 + '_password'] !== d2){
			alert("用户名或密码错误！");
		}
		else{
			nowname = d1;
			alert("登陆成功！已登录到此账号：" + d1);
			login_do();
		}
	};
	function lange(){
		var d1 = document.getElementById('naee').value;
		var d2 = document.getElementById('phin').value;
		var d3 = JSON.parse(pt('get',d1 + '_password'));
		if (d3[d1 + '_password'] === 'null'){
			var d4 = JSON.parse(pt('update',d1 + '_password',d2));
			if (d4['status'] === 'success'){
				nowname = d1;
				alert("创建账号成功！已登录到此账号：" + d1 + "，密码请熟记：" + d2 + " ！");
				login_do();
			}
			else{
				alert("尝试创建账号失败！请检查网络和输入！");
			}
		}
		else if (d3 !== ''){
			alert('已有这个账号！');
		}
		else{
			alert("创建账号失败！");
		}
	};
	function login_do(){
		var div = document.getElementById('chatdiv');
  		div.style.display = 'block';
		var newDiv = document.createElement('h4');
		newDiv.innerHTML = '当前账户名：' + nowname;
		if (div.children.length > 0) {
		    div.insertBefore(newDiv, div.children[0]);
		} else {
		    div.appendChild(newDiv);
		}
	};
    </script>
  </head>
  <body>
    <noscript>请打开 <code>javascript</code> 再进入此网站！</noscript>
    <div class = "leoth">
    <a href="https://yxy317coder.github.io/mail"><img src="src/pic.png" width="100" height="100" alt="三幺七的云邮网站~~~"></a>
    </div>
    <div class = "phing">
    <input type = "input" id = "naee" placeholder = "用户名"></input>
    <br>
    <input type = "input" id = "phin" placeholder = "密码"></input>
	<br>
	<br>
	<span><button onclick = "login()">登录</button><button onclick = "lange()">注册</button></span>
    </div>
	<br>
	<div id="chatdiv" class = "blim">
  		<marquee>测试中，这里暂时没有任何内容。&ensp;&ensp;&ensp;&ensp;&ensp;Testing...&nbsp;Nothing here...</marquee>
	</div>
  </body>
</html>
